__NUXT_JSONP__("/posts/managing-service-account-credentials-json-files", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw){return {data:[{post:{slug:"managing-service-account-credentials-json-files",title:"Managing Service Account JSON Files or Files with Secrets in Nodejs",summary:"",createdAt:G,updatedAt:G,publishedOn:H,author:{slug:I,name:"Kam Lasater",twitter:"@seekayel",dir:"\u002Fauthors",path:"\u002Fauthors\u002Fkam-lasater",extension:".json",createdAt:J,updatedAt:J,id:I},category:"Engineering",hidden:K,featured:K,public:H,image:L,thumbnail:L,toc:[{id:M,depth:p,text:N},{id:O,depth:p,text:P},{id:Q,depth:p,text:R},{id:S,depth:p,text:T},{id:U,depth:p,text:V},{id:W,depth:X,text:Y},{id:Z,depth:X,text:_},{id:$,depth:p,text:aa}],body:{type:"root",children:[{type:b,tag:ab,props:{id:"files-with-secrets-in-nodejs"},children:[{type:b,tag:h,props:{href:"#files-with-secrets-in-nodejs",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:"Files with Secrets in Nodejs"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"In our journey as Node.js developers, we often deal with various external services such as Google Cloud or Firebase. These services require us to provide credentials that authenticate our application and grant it the necessary permissions to interact with the respective service. This post is about to handle large secrets or files that contain private keys. Google provides files like this. You will see them named a few different things: "},{type:b,tag:g,props:{},children:[{type:a,value:"serviceAccount.json"}]},{type:a,value:" or sometimes "},{type:b,tag:g,props:{},children:[{type:a,value:"serviceAccountCredentials.json"}]},{type:a,value:". This file contains secret data and is used to authenticate against Google Cloud and\u002For Firebase."}]},{type:a,value:e},{type:b,tag:q,props:{id:M},children:[{type:b,tag:h,props:{href:"#why-an-account-service-json-file-is-needed-for-google-andor-firebase",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:N}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Google and Firebase provide us with a JSON files that contains private keys for our application to access their services. These JSON files, often referred to as \"account service\" files, contain the necessary credentials our application needs to authenticate itself with Google and Firebase."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"The JSON file includes several important pieces of information such as the "},{type:b,tag:g,props:{},children:[{type:a,value:"project_id"}]},{type:a,value:", "},{type:b,tag:g,props:{},children:[{type:a,value:ac}]},{type:a,value:", and "},{type:b,tag:g,props:{},children:[{type:a,value:"client_email"}]},{type:a,value:". This data is crucial for establishing an authenticated communication channel between our application and the respective service. Without this JSON file, our application won't be able to authenticate itself, thus not being able to access or interact with the resources provided by Google Cloud or Firebase."}]},{type:a,value:e},{type:b,tag:q,props:{id:O},children:[{type:b,tag:h,props:{href:"#why-the-serviceaccountjson-file-needs-to-be-kept-secret",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:P}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"As you can guess from the information contained within the JSON file, it's crucial that we keep these files secret and safe. If this file falls into the wrong hands, malicious users could use our "},{type:b,tag:g,props:{},children:[{type:a,value:ac}]},{type:a,value:" to impersonate our application and misuse the services, causing serious security issues. They could potentially access our Firebase data, use our Google Cloud resources, and even incur costs on our Google Cloud account."}]},{type:a,value:e},{type:b,tag:q,props:{id:Q},children:[{type:b,tag:h,props:{href:"#problems-with-storing-the-file-as-a-string-in-environment-variables",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:R}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"A common practice is to store sensitive data in environment variables. If you do this on AWS Lambda you can run into an issue. AWS Lambda limits the total size of all "},{type:b,tag:h,props:{href:"https:\u002F\u002Fdocs.aws.amazon.com\u002Flambda\u002Flatest\u002Fdg\u002Fconfiguration-envvars.html#:~:text=The%20total%20size%20of%20all%20environment%20variables%20doesn%27t%20exceed%204%20KB.",rel:[A,B,C],target:D},children:[{type:a,value:"environment variables to a maximum of 4KB"}]},{type:a,value:". Our JSON file along with a few other variables can easily exceed this limit, making it impossible to store the entire file in an environment variable. Worse case scenario is you are able to deploy your code and you only hit the environment variable size limit when you try to update another variable on some future release."}]},{type:a,value:e},{type:b,tag:q,props:{id:S},children:[{type:b,tag:h,props:{href:"#why-you-shouldnt-commit-secrets-to-your-git-repo",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:T}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"It might seem convenient to just commit the JSON file to our Git repository, but yeah, that is a very bad idea. Once a file is committed to a Git repository, its history remains there even if the file is later removed. This means that anyone with access to our repository can find and use these secrets."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"If our repository is ever made public, someone could read all the data in our database, delete our database or run up a huge cloud bill mining nonsense-coin. Therefore, it's best to avoid committing any sensitive data, like our JSON file, to our Git repository."}]},{type:a,value:e},{type:b,tag:q,props:{id:U},children:[{type:b,tag:h,props:{href:"#how-to-read-and-decrypt-a-file-before-initializing-the-firebase-sdk",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:V}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Instead of storing the JSON file directly or as an environment variable, we can encrypt it and then decrypt it when we need to initialize the Firebase SDK. We can use the example code here: "},{type:b,tag:h,props:{href:ad,rel:[A,B,C],target:D},children:[{type:a,value:ad}]}]},{type:a,value:e},{type:b,tag:ae,props:{id:W},children:[{type:b,tag:h,props:{href:"#encrypt-your-file",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:Y}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Follow the instructions in the repo, basically:"}]},{type:a,value:e},{type:b,tag:af,props:{},children:[{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:"clone"}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:ag},{type:b,tag:g,props:{},children:[{type:a,value:ah}]},{type:a,value:" to "},{type:b,tag:g,props:{},children:[{type:a,value:".env"}]}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:"run "},{type:b,tag:g,props:{},children:[{type:a,value:"npm run encrypt serviceAccount.json"}]}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:ai},{type:b,tag:g,props:{},children:[{type:a,value:"serviceAccount.json.secure"}]},{type:a,value:aj}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:ai},{type:b,tag:g,props:{},children:[{type:a,value:ak}]},{type:a,value:aj}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:ag},{type:b,tag:g,props:{},children:[{type:a,value:ah}]},{type:a,value:" to your project's environment variables"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{id:Z},children:[{type:b,tag:h,props:{href:"#decrypt-on-init",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:_}]},{type:a,value:e},{type:b,tag:al,props:{className:[am]},children:[{type:b,tag:an,props:{className:[ao,"language-js"]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:w}]},{type:a,value:" admin "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:x}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'firebase-admin'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:v}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:w}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:a,value:" decryptToString "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ar}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:x}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'.\u002Fsecure-file.js'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:v}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,as]},children:[{type:a,value:"\u002F\u002F replace with your location"}]},{type:a,value:"\n\n"},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:w}]},{type:a,value:" secureFileName "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:x}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"'.\u002FserviceAccount.json.secure'"}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,as]},children:[{type:a,value:"\u002F\u002F replace with your filename"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:w}]},{type:a,value:" jsonStr "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:x}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,r,"control-flow"]},children:[{type:a,value:"await"}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"decryptToString"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"secureFileName"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:v}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:w}]},{type:a,value:" serviceAccount "},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:x}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,"known-class-name","class-name"]},children:[{type:a,value:"JSON"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,F,t,z]},children:[{type:a,value:"parse"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"jsonStr"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:at}]},{type:a,value:"\n\nadmin"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,F,t,z]},children:[{type:a,value:"initializeApp"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:a,value:"\n  "},{type:b,tag:c,props:{className:[d,"literal-property","property"]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:":"}]},{type:a,value:" admin"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,F,t,z]},children:[{type:a,value:"cert"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"serviceAccount"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:","}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:at}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:q,props:{id:$},children:[{type:b,tag:h,props:{href:"#what-is-it-doing",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:aa}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"The "},{type:b,tag:g,props:{},children:[{type:a,value:ak}]},{type:a,value:" code is using "},{type:b,tag:h,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FGalois\u002FCounter_Mode",rel:[A,B,C],target:D},children:[{type:a,value:"AES256 GCM"}]},{type:a,value:" to symmetrically encrypt the input file. It also randomly generates an initialization vector ("},{type:b,tag:g,props:{},children:[{type:a,value:av}]},{type:a,value:"). It stores the "},{type:b,tag:g,props:{},children:[{type:a,value:av}]},{type:a,value:", encrypted data and a signature of both, "},{type:b,tag:g,props:{},children:[{type:a,value:"auth_tag"}]},{type:a,value:" to prevent against tampering. All three of these are stored in the "},{type:b,tag:g,props:{},children:[{type:a,value:".secure"}]},{type:a,value:" output file."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Sample format:"}]},{type:a,value:e},{type:b,tag:al,props:{className:[am]},children:[{type:b,tag:an,props:{className:[ao,"language-text"]},children:[{type:b,tag:g,props:{},children:[{type:a,value:"{\n  \"iv\": \"32-char-long-hex-string\",\n  \"auth_tag\": \"32-char-long-hex-string\",\n  \"data\": \"base64-encoded-encrypted-binary-data\"\n}\n"}]}]}]},{type:a,value:e},{type:b,tag:ab,props:{id:aw},children:[{type:b,tag:h,props:{href:"#tldr",ariaHidden:j,tabIndex:k},children:[{type:b,tag:c,props:{className:[l,m]},children:[]}]},{type:a,value:aw}]},{type:a,value:e},{type:b,tag:af,props:{},children:[{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:"Don't store account secrets in git unless you want to let everyone crypto mine on your server."}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:"If you hit size limits on environment variables, consider using an encrypted secure file."}]},{type:a,value:e},{type:b,tag:o,props:{},children:[{type:a,value:"Have a good time. Coding is fun."}]},{type:a,value:e}]}]},dir:"\u002Fposts",path:"\u002Fposts\u002Fmanaging-service-account-credentials-json-files",extension:".md"}}],fetch:{},mutations:void 0}}("text","element","span","token","\n","punctuation","code","a","p","true",-1,"icon","icon-link"," ","li",2,"h2","keyword","operator","function","(",")","const","=",".","property-access","nofollow","noopener","noreferrer","_blank","string","method","2023-06-16T13:35:38.000Z","Fri June 16 2023 13:35:38 GMT+0000 (Coordinated Universal Time)","kam-lasater","2023-09-04T13:32:35.737Z",false,"\u002Fcontent\u002Fsecure-file-dalle2.png","why-an-account-service-json-file-is-needed-for-google-andor-firebase","Why an Account Service JSON File is Needed for Google and\u002For Firebase","why-the-serviceaccountjson-file-needs-to-be-kept-secret","Why the serviceAccount.json File Needs to be Kept Secret","problems-with-storing-the-file-as-a-string-in-environment-variables","Problems with Storing the File as a String in Environment Variables","why-you-shouldnt-commit-secrets-to-your-git-repo","Why You Shouldn't Commit Secrets to Your Git Repo","how-to-read-and-decrypt-a-file-before-initializing-the-firebase-sdk","How to Read and Decrypt a File before Initializing the Firebase SDK","encrypt-your-file",3,"Encrypt your file","decrypt-on-init","Decrypt on init","what-is-it-doing","What is it doing?","h1","private_key","https:\u002F\u002Fgithub.com\u002Fcyclic-software\u002Fexample-secure-file","h3","ol","add ","SECRET_PASSPHRASE=\u003Csome long and secret passphrase\u003E","copy the "," file into your project","secure-file.js","div","nuxt-content-highlight","pre","line-numbers","require","{","}","comment",";","credential","iv","tldr")));