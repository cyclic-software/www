__NUXT_JSONP__("/posts/considerations-for-serverless-active-active-routing", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){return {data:[{post:{slug:"considerations-for-serverless-active-active-routing",title:"Considerations for Serverless Active-Active: Routing",summary:n,colId:"60d0f077b69e2df6b324616c",id:"623b3aed20c9065ace10b837",createdAt:"2022-03-23T15:21:17.000Z",updatedAt:"2022-04-19T16:03:40.000Z",publishedOn:"Wed Jun 08 2022 20:06:23 GMT+0000 (Coordinated Universal Time)",author:{slug:o,name:"Mike Korostelev",twitter:"@korostelevm",dir:"\u002Fauthors",path:"\u002Fauthors\u002Fmike-korostelev",extension:".json",createdAt:p,updatedAt:p,id:o},category:"AWS",hidden:q,featured:q,public:"Thu Mar 24 2022 00:00:00 GMT+0000 (Coordinated Universal Time)",image:r,thumbnail:r,toc:[{id:s,depth:2,text:t}],body:{type:"root",children:[{type:a,tag:j,props:{},children:[{type:a,tag:u,props:{},children:[{type:b,value:"(Part 1 of a series)"}]}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:n}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"Starting from the end user making an http request and assuming there are two identical instances of an application running in two AWS regions - this and next several posts will discuss considerations, tools and solutions for building serverless active-active architectures."}]},{type:b,value:c},{type:a,tag:"h2",props:{id:s},children:[{type:a,tag:d,props:{href:"#routing",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:a,tag:k,props:{},children:[{type:b,value:t}]}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"The first touchpoint for a request is DNS routing. This where the cloud DNS ("},{type:a,tag:d,props:{href:"https:\u002F\u002Faws.amazon.com\u002Froute53\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:b,value:"AWS Route53"}]},{type:b,value:") connects the request to your application's endpoints - in whatever region they are in the world."}]},{type:b,value:c},{type:a,tag:l,props:{id:"which-regional-instance-of-the-application-to-send-the-request-to"},children:[{type:a,tag:d,props:{href:"#which-regional-instance-of-the-application-to-send-the-request-to",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"Which regional instance of the application to send the request to?"}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"AWS Route53 lets you select a routing policy for DNS records. A regional policy will route users the closest geographic region ($0.70 per million queries). A latency policy will route to the the lowest query latency record ($0.60 per million queries). For high traffic web services, the TTL value should be considered as most web clients cache dns for the specified TTL."}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"If the record is configured as an alias to an AWS service (like cloudfront and api gateway) - the dns queries are free."}]},{type:b,value:c},{type:a,tag:l,props:{id:"how-to-know-that-the-instance-in-the-region-is-actually-healthy--before-routing-the-request"},children:[{type:a,tag:d,props:{href:"#how-to-know-that-the-instance-in-the-region-is-actually-healthy--before-routing-the-request",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"How to know that the instance in the region is actually healthy ✅ before routing the request?"}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"If a region is down (and it's not even your fault), Route53 does not know not to send requests there. To make Route53 know the state of an endpoint, health checks can be configured. Depending on the config, a health check is somewhere between $0.50 - $2.00 per month. Two ways to configure a health check are:"}]},{type:b,value:c},{type:a,tag:"ul",props:{},children:[{type:b,value:c},{type:a,tag:v,props:{},children:[{type:b,value:"Monitor an endpoint by continuously polling it from multiple regions - this will result in multiple requests per second to some endpoint where your application responds with some kind of 200. Since all these requests must be handled by something and can get expensive downstream from the traffic generated by the health check itself."}]},{type:b,value:c},{type:a,tag:v,props:{},children:[{type:b,value:"Monitor cloudwatch alarms - this lets you be more creative about what ‘healthy’ means and can go both ways on cost\u002Fcomplexity. This option is likely going to have more lag than monitoring an endpoint directly."}]},{type:b,value:c}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"Here the TTL is a more important consideration - since clients will cache dns - faster health-check polling intervals will not give you instantaneous routing switchover. So if users are actively using a service at the moment the switch over happens, you should have the expectation that they may still be hitting the failing endpoint until their dns cache expires."}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:a,tag:k,props:{},children:[{type:a,tag:u,props:{},children:[{type:b,value:"The next few posts will discuss these and other considerations, approaches and dirty hacks for building a low overhead active-active strategy with serverless on AWS:"}]}]}]},{type:b,value:c},{type:a,tag:l,props:{id:"compute"},children:[{type:a,tag:d,props:{href:"#compute",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:a,tag:k,props:{},children:[{type:b,value:"Compute"}]}]},{type:b,value:c},{type:a,tag:m,props:{id:"how-to-process-the-requests-in-both-regions-without-having-to-pay-for-two-computes"},children:[{type:a,tag:d,props:{href:"#how-to-process-the-requests-in-both-regions-without-having-to-pay-for-two-computes",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"How to process the requests in both regions without having to pay for two computes?"}]},{type:b,value:c},{type:a,tag:m,props:{id:"how-to-scale-capacity-if-suddenly-a-single-regional-application-instance-must-pick-up-the-slack-for-a-whole-other-regions-worth-of-traffic"},children:[{type:a,tag:d,props:{href:"#how-to-scale-capacity-if-suddenly-a-single-regional-application-instance-must-pick-up-the-slack-for-a-whole-other-regions-worth-of-traffic",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"How to scale capacity if suddenly a single regional application instance must pick up the slack for a whole other region’s worth of traffic?"}]},{type:b,value:c},{type:a,tag:l,props:{id:"data"},children:[{type:a,tag:d,props:{href:"#data",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:a,tag:k,props:{},children:[{type:b,value:"Data"}]}]},{type:b,value:c},{type:a,tag:m,props:{id:"how-to-make-sure-the-data-created-by-either-regional-application-instance-is-available-to-the-other"},children:[{type:a,tag:d,props:{href:"#how-to-make-sure-the-data-created-by-either-regional-application-instance-is-available-to-the-other",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"How to make sure the data created by either regional application instance is available to the other?"}]},{type:b,value:c},{type:a,tag:l,props:{id:"ops"},children:[{type:a,tag:d,props:{href:"#ops",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:a,tag:k,props:{},children:[{type:b,value:"Ops"}]}]},{type:b,value:c},{type:a,tag:m,props:{id:"human-decisions-are-political-decisions-politics-takes-time-in-a-disaster-time-is-scarce---how-to-remove-humans-from-the-process"},children:[{type:a,tag:d,props:{href:"#human-decisions-are-political-decisions-politics-takes-time-in-a-disaster-time-is-scarce---how-to-remove-humans-from-the-process",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"Human decisions are political decisions, politics takes time, in a disaster time is scarce - how to remove humans from the process?"}]},{type:b,value:c},{type:a,tag:m,props:{id:"how-to-manage-infrastructure-across-multiple-regions-without-multiplying-operational-overhead"},children:[{type:a,tag:d,props:{href:"#how-to-manage-infrastructure-across-multiple-regions-without-multiplying-operational-overhead",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"How to manage infrastructure across multiple regions without multiplying operational overhead?"}]},{type:b,value:c},{type:a,tag:l,props:{id:"latency"},children:[{type:a,tag:d,props:{href:"#latency",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:a,tag:k,props:{},children:[{type:b,value:"Latency"}]}]},{type:b,value:c},{type:a,tag:m,props:{id:"how-to-deal-with-eventual-consistency-and-the-fact-that-data-replication-is-not-instantaneous"},children:[{type:a,tag:d,props:{href:"#how-to-deal-with-eventual-consistency-and-the-fact-that-data-replication-is-not-instantaneous",ariaHidden:e,tabIndex:f},children:[{type:a,tag:g,props:{className:[h,i]},children:[]}]},{type:b,value:"How to deal with eventual consistency and the fact that data replication is not instantaneous?"}]},{type:b,value:c},{type:a,tag:j,props:{},children:[{type:b,value:"‍"}]}]},dir:"\u002Fposts",path:"\u002Fposts\u002Fconsiderations-for-serverless-active-active-routing",extension:".md"}}],fetch:{},mutations:void 0}}("element","text","\n","a","true",-1,"span","icon","icon-link","p","strong","h4","h5","Building active-active in multiple regions can be expensive and complex. Serverless-native applications can make it simpler to serve users globally and enable more effective recoveries with less effort.","mike-korostelev","2023-09-04T14:57:25.599Z",false,"\u002Fcontent\u002F623b489a8dc82ac713edaba0.png","routing","Routing","em","li")));